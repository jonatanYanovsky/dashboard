<!DOCTYPE html>
<html>

<head>
	<title>RADICAL dashboard</title>
	<meta charset="UTF-8">
	
	<!-- import Plotly.js -->
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body onload="start()">
	
	<style>
/*
	h1 {
		height: 200px;
		width: 400px;

		position: fixed;
		top: 50%;
		left: 50%;
		margin-top: -100px;
		margin-left: -200px;
	}

	p {
		height: 200px;
		width: 400px;

		position: fixed;
		top: 50%;
		left: 50%;
		margin-top: -100px;
		margin-left: -200px;
	}
	*/
	</style>

	<script>

	var plottedBefore = false;
	
	function start() {
		
		var type = getPlotType();
		
		
		//createEmpty();
		document.getElementById("plotName").innerHTML = type; // set the text above the plot
		
		server();
		setInterval(server2, 3000);

	}

	function getPlotType() { 
		var type = localStorage.getItem("plot");
		return type;
	}

	function setPlotURL(url) {
		var iframe = "<iframe width='500' height='500' frameborder='0' scrolling='no' src='" + url + ".embed?width=500&height=500'> </iframe>"
		document.getElementById("graph").src = url + ".embed";
	}
	
	function server() { // contacts server, requests iframe
		var req = new XMLHttpRequest(); // the request
		
		req.onload = function() {
			
			var ret = req.responseText;
			console.log(ret);
			setPlotURL(ret);
		}

		var plot = getPlotType();

		req.open("POST", "http://localhost:5000/", true);
		req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 		req.send("plot=" + plot);
	}

	function server2(ret) { // contacts server, extends trace
		var req = new XMLHttpRequest(); // the request

		req.onload = function() {
			
			var ret = req.responseText;
			console.log(ret);
			setPlotURL(ret);
		}

		var plot = getPlotType();

		req.open("POST", "http://localhost:5000/", true);
		req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 		req.send("plot=" + plot);
	}

	function createEmpty() {
		data = [{
			x: [],
			y: [],
			type: 'scatter'
		}];

		Plotly.newPlot('graph', data);
		plottedBefore = true;
	}


	function browserPlot(values) { // create empty plot
		console.log(values);

		var xval;
		var yval;
		var data;

		xval = values[0];
		yval = values[1];
	
		data = [{
			x: [xval],
			y: [yval],
			type: 'scatter'
		}];

			//if (plottedBefore) 
				//Plotly.purge('graph'); // clear old plot
		
		/*else {
			data = [{
				x: [],
				y: [],
				type: 'scatter'
			}];

		}*/

		//Plotly.purge('graph'); // clear old plot
		Plotly.newPlot('graph', data);
		//plottedBefore = true;
	}

	</script>


	
<h1>DASHBOARD</h1>

<p id="plotName"></p>

<div class="graphDiv">
<iframe id="graph" scrolling='no' style="width:100%; height:600px; border:none" seamless>></iframe>
</div>
<div id="graph">loading</div>
    

</body>
</html>

